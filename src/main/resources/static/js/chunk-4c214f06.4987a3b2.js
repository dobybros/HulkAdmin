(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4c214f06"],{"54d2":function(t,e,l){"use strict";l.r(e);l("456d"),l("7f7f"),l("ac6a");var i=l("9bd2");var a=[{value:"ios_apn"},{value:"android_fcm"},{value:"android_mi"}],n={data:function(){return{resPath:"https://resource.acucom.net/rest/resource/upload",filesMap:{},editingApp:{appId:"",platforms:[]},apps:[],dialogVisible:!1}},created:function(){var l=this;Object(i.a)({url:"/noti/apps",method:"get"}).then(function(t){l.$message.success("Updated!");var e=[];t.forEach(function(t){e.push(function(t){var l={};return l.appId=t.appId,l.platforms=[],t.platforms.forEach(function(t){var e={};e.file=t.fileFullName,e.type=t.platform,e.bundle=t.namespace,l.platforms.push(e)}),l}(t))}),l.apps=e}).catch(function(t){l.$message.error(t)})},methods:{newApp:function(){this.editingApp={appId:"",platforms:[]}},showDetail:function(t){this.editingApp=t,this.showModal()},checkValidity:function(){var a=this,n={},t=this.editingApp;if(!t.appId)throw new Error("App Id can not be null");if(!t.platforms||!t.platforms.length)throw new Error("One platform at least");return n.appId=t.appId,n.platforms=[],t.platforms.forEach(function(t){var e={};if(!t.type)throw new Error("Platform type is required");if(!t.file)throw new Error("Keychain file is required");var l=a.filesMap[t.file];if(!l)throw new Error("No updated keychain is found");e.namespace=t.bundle,e.platform=t.type,e.fileFullName=t.file;var i="https://resource.acucom.net/rest/resource/"+a.filesMap[t.file];e.keychainUri=i,e.keychainRid=l,n.platforms.push(e)}),n},showModal:function(){this.dialogVisible=!0},fileChanged:function(t,e){this.$delete(this.filesMap,t.name)},uploadedFile:function(t,e,l){this.$set(this.filesMap,e.name,t.data.file.rid)},uploadedFileFilter:function(e,t){var l=Object.keys(this.filesMap).map(function(t){return{value:t}});t(e?l.filter(function(t){return-1!==t.value.indexOf(e)}):l)},suggestions:function(e,t){t(e?a.filter(function(t){return-1!==t.value.indexOf(e)}):a)},addPlatform:function(){this.editingApp.platforms.push({bundle:"",type:"",file:null,id:(Math.random()+"").substring(2)})},removePlatform:function(t){this.editingApp.platforms.splice(t,1)},saveApp:function(){var e=this;try{(function(t){return Object(i.a)({url:"/noti/app",method:"post",data:t})})(this.checkValidity()).then(function(){e.dialogVisible=!1}).catch(function(t){e.$message.error(t)})}catch(t){this.$message.error(t.message)}}}},s=(l("b9ed"),l("2877")),o=function(t){t.options.__source="src/views/hulk/pushnotification/index.vue"},r=Object(s.a)(n,function(){var i=this,t=i.$createElement,a=i._self._c||t;return a("el-container",[a("el-header",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){i.newApp(),i.showModal()}}},[a("i",{staticClass:"el-icon-plus el-icon--left"}),i._v("\n      "+i._s(i.$t("views.pushnoti.new-app"))+"\n    ")])],1),a("el-main",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:i.apps}},[a("el-table-column",{attrs:{prop:"appId",label:i.$t("views.pushnoti.title.app-id"),width:"180"}}),a("el-table-column",{attrs:{type:"expand"},scopedSlots:i._u([{key:"default",fn:function(t){return[a("el-table",{attrs:{data:t.row.platforms}},[a("el-table-column",{attrs:{prop:"type",label:i.$t("views.pushnoti.title.platform")}}),a("el-table-column",{attrs:{prop:"bundle",label:i.$t("views.pushnoti.title.bundle-id")}}),a("el-table-column",{attrs:{prop:"file",label:i.$t("views.pushnoti.title.keychain")}})],1)]}}])}),a("el-table-column",{attrs:{label:i.$t("views.pushnoti.title.platforms")},scopedSlots:i._u([{key:"default",fn:function(t){return[i._v("\n          "+i._s(t.row.platforms.length)+"\n        ")]}}])}),a("el-table-column",{attrs:{width:"180",label:i.$t("views.pushnoti.title.actions")},scopedSlots:i._u([{key:"default",fn:function(e){return[a("el-button",{on:{click:function(t){return i.showDetail(e.row)}}},[i._v(i._s(i.$t("views.pushnoti.detail")))])]}}])})],1)],1),a("el-dialog",{attrs:{visible:i.dialogVisible},on:{"update:visible":function(t){i.dialogVisible=t}}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-upload",{attrs:{action:i.resPath,drag:"","on-remove":i.fileChanged,"on-success":i.uploadedFile,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",[i._v(i._s(i.$t("views.pushnoti.uploadFileHere")))])])],1),a("el-row",[a("el-col",{staticClass:"model-title"},[i._v(i._s(i.$t("views.pushnoti.title.app-id")))]),a("el-col",[a("el-input",{attrs:{clearable:""},model:{value:i.editingApp.appId,callback:function(t){i.$set(i.editingApp,"appId",t)},expression:"editingApp.appId"}})],1)],1),a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-col",{staticClass:"model-title",attrs:{span:6}},[i._v(i._s(i.$t("views.pushnoti.title.platforms")))])],1),i._l(i.editingApp.platforms,function(e,l){return a("el-card",{key:e.id,staticStyle:{"margin-top":"5px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[i._v(i._s(i.$t("views.pushnoti.title.platform")))]),a("el-col",{attrs:{span:18}},[a("el-autocomplete",{attrs:{"fetch-suggestions":i.suggestions,clearable:""},model:{value:e.type,callback:function(t){i.$set(e,"type",t)},expression:"platform.type"}})],1)],1),a("el-row",[a("el-col",{staticClass:"model-title",attrs:{span:6}},[i._v(i._s(i.$t("views.pushnoti.title.bundle-id")))]),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{clearable:""},model:{value:e.bundle,callback:function(t){i.$set(e,"bundle",t)},expression:"platform.bundle"}})],1)],1),a("el-row",[a("el-col",{attrs:{span:6}},[i._v(i._s(i.$t("views.pushnoti.title.keychain")))]),a("el-col",{attrs:{span:18}},[a("el-autocomplete",{attrs:{"fetch-suggestions":i.uploadedFileFilter,clearable:""},model:{value:e.file,callback:function(t){i.$set(e,"file",t)},expression:"platform.file"}})],1)],1),a("el-row",[a("el-button",{staticStyle:{width:"100%"},attrs:{size:"mini",type:"danger",round:"",icon:"el-icon-delete"},on:{click:function(t){return i.removePlatform(l)}}})],1)],1)}),a("el-row",{staticClass:"add-btn"},[a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{icon:"el-icon-plus",circle:""},on:{click:i.addPlatform}})],1),a("el-row",[a("el-button",{staticStyle:{width:"100%","margin-top":"15px"},attrs:{type:"primary",round:""},on:{click:i.saveApp}},[i._v("\n        "+i._s(i.$t("views.pushnoti.title.save"))+"\n      ")])],1)],2)],1)},[],!1,null,"34ba5c6a",null);"function"==typeof o&&o(r);e.default=r.exports},a866:function(t,e,l){},b9ed:function(t,e,l){"use strict";var i=l("a866");l.n(i).a}}]);